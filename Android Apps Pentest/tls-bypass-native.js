// SSL_get_verify_result
try {
    const SSL_get_verify_result = Module.getExportByName(null, "SSL_get_verify_result");
    Interceptor.attach(SSL_get_verify_result, {
        onEnter(args) {
            console.log("[*] SSL_get_verify_result called");
        },
        onLeave(retval) {
            console.log("[-] Original SSL_get_verify_result return value: " + retval);
            retval.replace(0); // 0 = X509_V_OK
            console.log("[+] Patched SSL_get_verify_result to return 0 (X509_V_OK)");
        }
    });
} catch (err) {
    console.error("[-] Failed to hook SSL_get_verify_result: " + err.message);
}

// SSL_CTX_set_custom_verify
try {
    const SSL_CTX_set_custom_verify = Module.getExportByName(null, "SSL_CTX_set_custom_verify");
    Interceptor.attach(SSL_CTX_set_custom_verify, {
        onEnter(args) {
            console.log("[*] SSL_CTX_set_custom_verify called - disabling custom verify callback");
            args[2] = ptr(0); // Null out callback
        }
    });
} catch (err) {
    console.error("[-] Failed to hook SSL_CTX_set_custom_verify: " + err.message);
}

// X509_verify_cert
try {
    const X509_verify_cert = Module.getExportByName(null, "X509_verify_cert");
    Interceptor.attach(X509_verify_cert, {
        onEnter(args) {
            console.log("[*] X509_verify_cert called");
        },
        onLeave(retval) {
            console.log("[-] Original X509_verify_cert retval: " + retval);
            retval.replace(1); // 1 = success
            console.log("[+] Patched X509_verify_cert to return 1 (success)");
        }
    });
} catch (err) {
    console.error("[-] Failed to hook X509_verify_cert: " + err.message);
}

// SSL_get_peer_cert_chain (log-only)
try {
    const SSL_get_peer_cert_chain = Module.getExportByName(null, "SSL_get_peer_cert_chain");
    Interceptor.attach(SSL_get_peer_cert_chain, {
        onEnter(args) {
            console.log("[*] SSL_get_peer_cert_chain called");
        },
        onLeave(retval) {
            console.log("[-] SSL_get_peer_cert_chain returned: " + retval);
        }
    });
} catch (err) {
    console.error("[-] Failed to hook SSL_get_peer_cert_chain: " + err.message);
}
